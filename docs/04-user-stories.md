# Пользовательские истории

**Проект:** NiceMusicLibrary
**Версия документа:** 1.0
**Дата:** 2025-01

---

## Формат историй

**Шаблон:** «Как {роль}, я хочу {действие}, чтобы {цель/выгода}»

| Компонент | Описание |
|-----------|----------|
| Роль | Кто совершает действие |
| Действие | Что пользователь хочет сделать |
| Выгода | Какую выгоду это принесёт |
| Критерии приёмки | Условия, при которых история считается выполненной |

---

## US-001: Загрузка и организация личной музыкальной коллекции

**Приоритет:** Высокий
**Эпик:** Управление библиотекой

### История

> Как **пользователь с коллекцией музыки на компьютере**,
> я хочу **загрузить свои музыкальные файлы и автоматически организовать их**,
> чтобы **иметь единое место для хранения и доступа ко всей своей музыке**.

### Описание

Пользователь имеет большую коллекцию музыкальных файлов (MP3, FLAC, и т.д.) на своём компьютере. Он хочет загрузить их в приложение, чтобы слушать с любого устройства и иметь удобный каталог с автоматическим извлечением метаданных (название, исполнитель, альбом, обложка).

### Критерии приёмки

| ID | Критерий |
|----|----------|
| AC-001-1 | Пользователь может загрузить один или несколько файлов через drag-and-drop или диалог выбора |
| AC-001-2 | Система поддерживает форматы: MP3, FLAC, OGG, WAV, AAC |
| AC-001-3 | Метаданные (название, исполнитель, альбом, год, жанр, обложка) автоматически извлекаются из файла |
| AC-001-4 | Пользователь видит прогресс загрузки для каждого файла |
| AC-001-5 | После загрузки песни появляются в библиотеке с возможностью поиска |
| AC-001-6 | Пользователь может редактировать метаданные загруженных треков |
| AC-001-7 | Максимальный размер файла: 100 МБ |

### Сценарии

#### Массовая загрузка

**Дано:** Пользователь авторизован и находится в библиотеке

**Когда:** Перетаскивает папку с 50 MP3-файлами

**Тогда:**
- Система показывает общий прогресс загрузки
- Каждый файл обрабатывается параллельно
- По завершении все треки доступны в библиотеке
- Дубликаты определяются и помечаются

#### Редактирование метаданных

**Дано:** Песня загружена с неполными метаданными

**Когда:** Пользователь открывает редактирование трека

**Тогда:**
- Может изменить название, исполнителя, альбом
- Может загрузить новую обложку
- Изменения сохраняются мгновенно

### Элементы UI

- Кнопка «Загрузить музыку»
- Область drag-and-drop
- Индикатор прогресса загрузки
- Модальное окно редактирования метаданных

### API эндпоинты

- `POST /songs`
- `POST /songs/batch`
- `PATCH /songs/{id}`
- `GET /songs/batch/{batch_id}/status`

---

## US-002: Прослушивание музыки с удобным плеером

**Приоритет:** Высокий
**Эпик:** Воспроизведение

### История

> Как **любитель музыки**,
> я хочу **слушать свою музыку с современным и удобным плеером**,
> чтобы **наслаждаться музыкой с полным контролем воспроизведения**.

### Описание

Пользователь хочет слушать музыку из своей библиотеки с помощью функционального плеера, который позволяет управлять воспроизведением, создавать очередь, перематывать и видеть информацию о текущем треке.

### Критерии приёмки

| ID | Критерий |
|----|----------|
| AC-002-1 | Плеер отображает: обложку, название, исполнителя, прогресс трека |
| AC-002-2 | Доступны кнопки: play/pause, prev, next, shuffle, repeat |
| AC-002-3 | Пользователь может перематывать трек кликом по прогресс-бару |
| AC-002-4 | Регулятор громкости с памятью последнего значения |
| AC-002-5 | Очередь воспроизведения с возможностью изменения порядка |
| AC-002-6 | Мини-плеер в углу экрана при прокрутке страницы |
| AC-002-7 | Горячие клавиши: пробел (play/pause), стрелки (перемотка), +/- (громкость) |
| AC-002-8 | Непрерывное воспроизведение при навигации между страницами |

### Сценарии

#### Запуск воспроизведения

**Дано:** Пользователь находится в библиотеке

**Когда:** Нажимает на трек или кнопку play

**Тогда:**
- Плеер появляется внизу экрана
- Трек начинает воспроизводиться
- Отображается обложка и информация

#### Управление очередью

**Дано:** Трек воспроизводится

**Когда:** Пользователь добавляет другие треки в очередь

**Тогда:**
- Треки добавляются в конец очереди
- Можно просмотреть и изменить очередь
- Можно удалить треки из очереди

### Элементы UI

- Полноэкранный плеер
- Мини-плеер (sticky footer)
- Панель очереди (выдвижная справа)
- Прогресс-бар с таймкодами

### API эндпоинты

- `GET /songs/{id}/stream`
- `POST /stats/play`

---

## US-003: Создание тематических плейлистов

**Приоритет:** Высокий
**Эпик:** Плейлисты

### История

> Как **организованный слушатель**,
> я хочу **создавать плейлисты для разных ситуаций и настроений**,
> чтобы **быстро находить подходящую музыку для любого момента**.

### Описание

Пользователь хочет организовать свою музыку в плейлисты: для тренировок, для работы, для вечеринок и т.д. Плейлисты должны быть легко создаваемыми и редактируемыми.

### Критерии приёмки

| ID | Критерий |
|----|----------|
| AC-003-1 | Пользователь может создать новый плейлист с названием и описанием |
| AC-003-2 | Можно добавить песни в плейлист из библиотеки или контекстного меню |
| AC-003-3 | Можно изменять порядок песен drag-and-drop |
| AC-003-4 | Отображается общая длительность плейлиста |
| AC-003-5 | Можно установить обложку плейлиста |
| AC-003-6 | Можно удалить песни из плейлиста без удаления из библиотеки |
| AC-003-7 | Быстрое воспроизведение плейлиста одной кнопкой |

### Сценарии

#### Создание плейлиста для тренировки

**Дано:** Пользователь хочет плейлист для спортзала

**Когда:** Создаёт плейлист «Тренировка» и добавляет энергичные треки

**Тогда:**
- Плейлист сохраняется с выбранными треками
- Можно запустить одной кнопкой
- Отображается в списке плейлистов

#### Быстрое добавление в плейлист

**Дано:** Пользователь слушает трек

**Когда:** Нажимает «Добавить в плейлист» в контекстном меню

**Тогда:**
- Появляется список существующих плейлистов
- Можно выбрать плейлист или создать новый
- Трек добавляется мгновенно

### Элементы UI

- Список плейлистов (sidebar)
- Страница плейлиста
- Модальное окно создания плейлиста
- Контекстное меню трека

### API эндпоинты

- `GET /playlists`
- `POST /playlists`
- `GET /playlists/{id}`
- `POST /playlists/{id}/songs`
- `PUT /playlists/{id}/songs/order`

---

## US-004: Создание и использование цепочек настроений

**Приоритет:** Высокий
**Эпик:** Цепочки настроений

### История

> Как **ценитель атмосферного прослушивания**,
> я хочу **создавать «вайбовые» цепочки треков, плавно перетекающих друг в друга**,
> чтобы **получать непрерывный музыкальный опыт, соответствующий моему настроению**.

### Описание

Пользователь хочет не просто плейлист, а умную цепочку треков, где каждый следующий трек логично продолжает предыдущий по настроению, энергии или жанру. Система должна предлагать варианты следующего трека на основе анализа музыки и истории прослушиваний.

### Критерии приёмки

| ID | Критерий |
|----|----------|
| AC-004-1 | Можно создать цепочку настроений с названием и тегами настроения |
| AC-004-2 | Можно добавить треки вручную с указанием переходов |
| AC-004-3 | При воспроизведении система предлагает 3 варианта следующего трека |
| AC-004-4 | Можно создать цепочку автоматически из истории прослушиваний за период |
| AC-004-5 | Доступны стили перехода: плавный, по энергии, по жанру, случайный |
| AC-004-6 | Визуализация цепочки показывает связи между треками |
| AC-004-7 | Пользователь может принять или отклонить предложенный следующий трек |

### Сценарии

#### Интерактивное воспроизведение

**Дано:** Пользователь запустил цепочку настроений

**Когда:** Текущий трек подходит к концу (осталось 30 секунд)

**Тогда:**
- Появляются 3 предложения следующего трека
- Показан % совместимости каждого варианта
- Пользователь выбирает или позволяет авто-выбор
- Выбранный трек плавно начинается (crossfade)

#### Создание из истории

**Дано:** Пользователь слушал музыку весь январь

**Когда:** Выбирает «Создать цепочку из истории» за январь

**Тогда:**
- Система анализирует частые переходы между треками
- Создаёт цепочку из 20-30 треков
- Показывает предпросмотр с весами переходов

#### Ручное создание вайб-цепочки

**Дано:** Пользователь хочет создать идеальную вечернюю подборку

**Когда:** Открывает конструктор цепочек и добавляет треки

**Тогда:**
- Можно искать и добавлять треки
- Видно «совместимость» трека с предыдущим
- Можно настроить вес перехода вручную

### Элементы UI

- Конструктор цепочек (визуальный редактор)
- Мини-карточки предложений (при воспроизведении)
- Граф связей треков
- Мастер создания из истории

### API эндпоинты

- `GET /mood-chains`
- `POST /mood-chains`
- `POST /mood-chains/from-history`
- `GET /mood-chains/{id}/next`
- `PATCH /mood-chains/{id}`

---

## US-005: Просмотр статистики прослушиваний

**Приоритет:** Средний
**Эпик:** Аналитика

### История

> Как **любопытный меломан**,
> я хочу **видеть статистику своих прослушиваний**,
> чтобы **понимать свои музыкальные предпочтения и открывать закономерности**.

### Описание

Пользователь хочет видеть детальную статистику: топ треков и исполнителей, общее время прослушивания, распределение по жанрам и времени суток. Это помогает понять свои вкусы и открывает интересные паттерны.

### Критерии приёмки

| ID | Критерий |
|----|----------|
| AC-005-1 | Дашборд показывает общее время прослушивания за период |
| AC-005-2 | Топ-10 песен с количеством прослушиваний |
| AC-005-3 | Топ-10 исполнителей |
| AC-005-4 | Распределение по жанрам (pie chart) |
| AC-005-5 | График прослушиваний по дням/неделям |
| AC-005-6 | Тепловая карта активности по часам |
| AC-005-7 | Выбор периода: неделя, месяц, год, всё время |
| AC-005-8 | Для каждой песни видно последнее и общее количество прослушиваний |

### Сценарии

#### Обзор месячной статистики

**Дано:** Пользователь активно слушал музыку месяц

**Когда:** Открывает страницу статистики

**Тогда:**
- Видит общее время (например, «48 часов»)
- Видит топ-10 треков с обложками
- Видит распределение по жанрам
- Может переключить на другой период

#### Детальная статистика трека

**Дано:** Пользователь смотрит информацию о песне

**Когда:** Открывает вкладку «Статистика»

**Тогда:**
- Видит общее количество прослушиваний
- Дату последнего прослушивания
- График прослушиваний по времени

### Элементы UI

- Страница «Статистика»
- Виджеты с ключевыми метриками
- Графики (line, bar, pie)
- Тепловая карта
- Селектор периода

### API эндпоинты

- `GET /stats/overview`
- `GET /stats/top-songs`
- `GET /stats/history`

---

## US-006: Быстрый поиск и фильтрация музыки

**Приоритет:** Высокий
**Эпик:** Поиск

### История

> Как **пользователь с большой библиотекой**,
> я хочу **быстро находить нужные треки через поиск и фильтры**,
> чтобы **не тратить время на пролистывание большого каталога**.

### Описание

Когда в библиотеке сотни или тысячи треков, важно иметь быстрый поиск и гибкие фильтры для нахождения нужной музыки.

### Критерии приёмки

| ID | Критерий |
|----|----------|
| AC-006-1 | Глобальный поиск доступен с любой страницы (Ctrl+K) |
| AC-006-2 | Поиск ищет по названию, исполнителю, альбому |
| AC-006-3 | Результаты появляются по мере ввода (instant search) |
| AC-006-4 | Можно фильтровать по жанру, году, рейтингу |
| AC-006-5 | Сортировка: по названию, дате добавления, популярности |
| AC-006-6 | Можно искать по тегам |
| AC-006-7 | История поисковых запросов |

### Сценарии

#### Быстрый поиск трека

**Дано:** Пользователь хочет найти «Bohemian Rhapsody»

**Когда:** Нажимает Ctrl+K и вводит «bohemian»

**Тогда:**
- Результаты появляются мгновенно
- Нужный трек виден в топе
- Можно запустить прямо из результатов

#### Фильтрация по жанру

**Дано:** Пользователь хочет только рок-музыку

**Когда:** Выбирает фильтр «Жанр: Rock»

**Тогда:**
- Показаны только треки жанра Rock
- Фильтр можно комбинировать с поиском

### Элементы UI

- Глобальный поиск (command palette)
- Панель фильтров в библиотеке
- Чипсы активных фильтров
- Сортировка (dropdown)

### API эндпоинты

- `GET /search`
- `GET /songs?search=...&genre=...&sort=...`

---

## US-007: Получение персональных рекомендаций

**Приоритет:** Средний
**Эпик:** Рекомендации

### История

> Как **слушатель, желающий открывать новую музыку**,
> я хочу **получать рекомендации на основе моих предпочтений**,
> чтобы **находить новые любимые треки в своей библиотеке**.

### Описание

На основе истории прослушиваний и избранного система должна предлагать треки из библиотеки, которые пользователь мог не заметить или забыть.

### Критерии приёмки

| ID | Критерий |
|----|----------|
| AC-007-1 | Раздел «Рекомендации» на главной странице |
| AC-007-2 | Рекомендации «Похожие на...» для любого трека |
| AC-007-3 | «Вы давно не слушали» — забытые треки |
| AC-007-4 | Объяснение, почему трек рекомендован |
| AC-007-5 | Возможность отклонить рекомендацию («не показывать») |

### Сценарии

#### Открытие забытого трека

**Дано:** Пользователь давно не слушал некоторые треки

**Когда:** Открывает «Рекомендации»

**Тогда:**
- Видит секцию «Вы давно не слушали»
- Показаны треки с высоким рейтингом, не игравшие 30+ дней
- Может запустить трек или добавить в очередь

### Элементы UI

- Карусель рекомендаций
- Карточка рекомендации с причиной
- Кнопки «Нравится» / «Не нравится»

### API эндпоинты

- `GET /recommendations/discover`
- `GET /recommendations/similar/{song_id}`

---

## Дополнительные истории

### US-008: Использование тегов для организации

**Приоритет:** Низкий
**Эпик:** Организация

> Как **педантичный пользователь**,
> я хочу **добавлять собственные теги к трекам**,
> чтобы **организовать музыку по своим критериям**.

**Ключевые функции:**
- Создание пользовательских тегов с цветами
- Добавление нескольких тегов к треку
- Фильтрация библиотеки по тегам
- Быстрое добавление тега через контекстное меню

### US-009: Офлайн-доступ (PWA)

**Приоритет:** Средний
**Эпик:** Мобильность

> Как **мобильный пользователь**,
> я хочу **слушать музыку без интернета**,
> чтобы **иметь доступ к любимым трекам в самолёте или метро**.

**Ключевые функции:**
- Пометка треков/плейлистов для офлайн-доступа
- Автоматическая загрузка в фоне
- Управление кэшем (лимит по размеру)
- Индикация офлайн-доступности

### US-010: Импорт из других сервисов

**Приоритет:** Низкий
**Эпик:** Импорт

> Как **новый пользователь**,
> я хочу **импортировать плейлисты из Spotify/Apple Music**,
> чтобы **перенести свою музыкальную историю**.

**Ключевые функции:**
- Импорт списка треков из CSV/JSON
- Сопоставление с загруженной библиотекой
- Отчёт о найденных/ненайденных треках

---

## Матрица приоритетов

### Must Have (обязательно)

- US-001: Загрузка музыки
- US-002: Воспроизведение
- US-003: Плейлисты
- US-006: Поиск

### Should Have (желательно)

- US-004: Цепочки настроений
- US-005: Статистика
- US-007: Рекомендации

### Could Have (возможно)

- US-008: Теги
- US-009: Офлайн
- US-010: Импорт

---

## Персоны пользователей

### Алексей, 28 — Активный слушатель

**Описание:** Программист, слушает музыку 4-5 часов в день во время работы. Имеет большую коллекцию FLAC-файлов. Ценит качество звука и удобную организацию библиотеки.

**Цели:**
- Быстро находить нужную музыку
- Не отвлекаться на управление плеером
- Иметь разные плейлисты для разных задач

**Проблемы:**
- Текущий плеер неудобен
- Сложно организовать 5000+ треков

### Мария, 24 — Вайб-слушатель

**Описание:** Дизайнер, для неё музыка — это настроение. Любит создавать атмосферные подборки и плавные переходы между треками.

**Цели:**
- Создавать идеальные вайбовые подборки
- Открывать связи между треками
- Делиться настроением

**Проблемы:**
- Плейлисты слишком статичны
- Нет инструмента для «вайб-цепочек»

### Дмитрий, 35 — Коллекционер

**Описание:** Аудиофил с 15-летней коллекцией музыки. Педантично организует метаданные, следит за качеством файлов, ведёт статистику.

**Цели:**
- Полный контроль над метаданными
- Детальная статистика прослушиваний
- Поддержка lossless форматов

**Проблемы:**
- Сервисы портят метаданные
- Нет нормальной статистики
