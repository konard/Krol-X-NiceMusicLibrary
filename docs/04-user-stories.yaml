# Пользовательские истории персональной музыкальной библиотеки
# NiceMusicLibrary - Technical Specification: User Stories

meta:
  document: "Пользовательские истории"
  version: "1.0"
  date: "2025-01"
  project: "NiceMusicLibrary"

# =============================================================================
# ФОРМАТ ИСТОРИЙ
# =============================================================================

format:
  template: "Как {роль}, я хочу {действие}, чтобы {цель/выгода}"
  components:
    - role: "Кто совершает действие"
    - action: "Что пользователь хочет сделать"
    - benefit: "Какую выгоду это принесёт"
  acceptance_criteria: "Условия, при которых история считается выполненной"

# =============================================================================
# ИСТОРИЯ 1: ЗАГРУЗКА И ОРГАНИЗАЦИЯ МУЗЫКИ
# =============================================================================

user_stories:

  - id: "US-001"
    title: "Загрузка и организация личной музыкальной коллекции"
    priority: "high"
    epic: "Управление библиотекой"

    story:
      as_a: "Пользователь с коллекцией музыки на компьютере"
      i_want: "Загрузить свои музыкальные файлы и автоматически организовать их"
      so_that: "Иметь единое место для хранения и доступа ко всей своей музыке"

    description: >
      Пользователь имеет большую коллекцию музыкальных файлов (MP3, FLAC, и т.д.)
      на своём компьютере. Он хочет загрузить их в приложение, чтобы слушать
      с любого устройства и иметь удобный каталог с автоматическим извлечением
      метаданных (название, исполнитель, альбом, обложка).

    acceptance_criteria:
      - id: "AC-001-1"
        criterion: "Пользователь может загрузить один или несколько файлов через drag-and-drop или диалог выбора"
        testable: true

      - id: "AC-001-2"
        criterion: "Система поддерживает форматы: MP3, FLAC, OGG, WAV, AAC"
        testable: true

      - id: "AC-001-3"
        criterion: "Метаданные (название, исполнитель, альбом, год, жанр, обложка) автоматически извлекаются из файла"
        testable: true

      - id: "AC-001-4"
        criterion: "Пользователь видит прогресс загрузки для каждого файла"
        testable: true

      - id: "AC-001-5"
        criterion: "После загрузки песни появляются в библиотеке с возможностью поиска"
        testable: true

      - id: "AC-001-6"
        criterion: "Пользователь может редактировать метаданные загруженных треков"
        testable: true

      - id: "AC-001-7"
        criterion: "Максимальный размер файла: 100 МБ"
        testable: true

    scenarios:
      - name: "Массовая загрузка"
        given: "Пользователь авторизован и находится в библиотеке"
        when: "Перетаскивает папку с 50 MP3-файлами"
        then:
          - "Система показывает общий прогресс загрузки"
          - "Каждый файл обрабатывается параллельно"
          - "По завершении все треки доступны в библиотеке"
          - "Дубликаты определяются и помечаются"

      - name: "Редактирование метаданных"
        given: "Песня загружена с неполными метаданными"
        when: "Пользователь открывает редактирование трека"
        then:
          - "Может изменить название, исполнителя, альбом"
          - "Может загрузить новую обложку"
          - "Изменения сохраняются мгновенно"

    ui_elements:
      - "Кнопка 'Загрузить музыку'"
      - "Область drag-and-drop"
      - "Индикатор прогресса загрузки"
      - "Модальное окно редактирования метаданных"

    api_endpoints:
      - "POST /songs"
      - "POST /songs/batch"
      - "PATCH /songs/{id}"
      - "GET /songs/batch/{batch_id}/status"

# =============================================================================
# ИСТОРИЯ 2: ВОСПРОИЗВЕДЕНИЕ И ПЛЕЕР
# =============================================================================

  - id: "US-002"
    title: "Прослушивание музыки с удобным плеером"
    priority: "high"
    epic: "Воспроизведение"

    story:
      as_a: "Любитель музыки"
      i_want: "Слушать свою музыку с современным и удобным плеером"
      so_that: "Наслаждаться музыкой с полным контролем воспроизведения"

    description: >
      Пользователь хочет слушать музыку из своей библиотеки с помощью
      функционального плеера, который позволяет управлять воспроизведением,
      создавать очередь, перематывать и видеть информацию о текущем треке.

    acceptance_criteria:
      - id: "AC-002-1"
        criterion: "Плеер отображает: обложку, название, исполнителя, прогресс трека"
        testable: true

      - id: "AC-002-2"
        criterion: "Доступны кнопки: play/pause, prev, next, shuffle, repeat"
        testable: true

      - id: "AC-002-3"
        criterion: "Пользователь может перематывать трек кликом по прогресс-бару"
        testable: true

      - id: "AC-002-4"
        criterion: "Регулятор громкости с памятью последнего значения"
        testable: true

      - id: "AC-002-5"
        criterion: "Очередь воспроизведения с возможностью изменения порядка"
        testable: true

      - id: "AC-002-6"
        criterion: "Мини-плеер в углу экрана при прокрутке страницы"
        testable: true

      - id: "AC-002-7"
        criterion: "Горячие клавиши: пробел (play/pause), стрелки (перемотка), +/- (громкость)"
        testable: true

      - id: "AC-002-8"
        criterion: "Непрерывное воспроизведение при навигации между страницами"
        testable: true

    scenarios:
      - name: "Запуск воспроизведения"
        given: "Пользователь находится в библиотеке"
        when: "Нажимает на трек или кнопку play"
        then:
          - "Плеер появляется внизу экрана"
          - "Трек начинает воспроизводиться"
          - "Отображается обложка и информация"

      - name: "Управление очередью"
        given: "Трек воспроизводится"
        when: "Пользователь добавляет другие треки в очередь"
        then:
          - "Треки добавляются в конец очереди"
          - "Можно просмотреть и изменить очередь"
          - "Можно удалить треки из очереди"

    ui_elements:
      - "Полноэкранный плеер"
      - "Мини-плеер (sticky footer)"
      - "Панель очереди (выдвижная справа)"
      - "Прогресс-бар с таймкодами"

    api_endpoints:
      - "GET /songs/{id}/stream"
      - "POST /stats/play"

# =============================================================================
# ИСТОРИЯ 3: СОЗДАНИЕ И УПРАВЛЕНИЕ ПЛЕЙЛИСТАМИ
# =============================================================================

  - id: "US-003"
    title: "Создание тематических плейлистов"
    priority: "high"
    epic: "Плейлисты"

    story:
      as_a: "Организованный слушатель"
      i_want: "Создавать плейлисты для разных ситуаций и настроений"
      so_that: "Быстро находить подходящую музыку для любого момента"

    description: >
      Пользователь хочет организовать свою музыку в плейлисты: для тренировок,
      для работы, для вечеринок и т.д. Плейлисты должны быть легко создаваемыми
      и редактируемыми.

    acceptance_criteria:
      - id: "AC-003-1"
        criterion: "Пользователь может создать новый плейлист с названием и описанием"
        testable: true

      - id: "AC-003-2"
        criterion: "Можно добавить песни в плейлист из библиотеки или контекстного меню"
        testable: true

      - id: "AC-003-3"
        criterion: "Можно изменять порядок песен drag-and-drop"
        testable: true

      - id: "AC-003-4"
        criterion: "Отображается общая длительность плейлиста"
        testable: true

      - id: "AC-003-5"
        criterion: "Можно установить обложку плейлиста"
        testable: true

      - id: "AC-003-6"
        criterion: "Можно удалить песни из плейлиста без удаления из библиотеки"
        testable: true

      - id: "AC-003-7"
        criterion: "Быстрое воспроизведение плейлиста одной кнопкой"
        testable: true

    scenarios:
      - name: "Создание плейлиста для тренировки"
        given: "Пользователь хочет плейлист для спортзала"
        when: "Создаёт плейлист 'Тренировка' и добавляет энергичные треки"
        then:
          - "Плейлист сохраняется с выбранными треками"
          - "Можно запустить одной кнопкой"
          - "Отображается в списке плейлистов"

      - name: "Быстрое добавление в плейлист"
        given: "Пользователь слушает трек"
        when: "Нажимает 'Добавить в плейлист' в контекстном меню"
        then:
          - "Появляется список существующих плейлистов"
          - "Можно выбрать плейлист или создать новый"
          - "Трек добавляется мгновенно"

    ui_elements:
      - "Список плейлистов (sidebar)"
      - "Страница плейлиста"
      - "Модальное окно создания плейлиста"
      - "Контекстное меню трека"

    api_endpoints:
      - "GET /playlists"
      - "POST /playlists"
      - "GET /playlists/{id}"
      - "POST /playlists/{id}/songs"
      - "PUT /playlists/{id}/songs/order"

# =============================================================================
# ИСТОРИЯ 4: ЦЕПОЧКИ НАСТРОЕНИЙ
# =============================================================================

  - id: "US-004"
    title: "Создание и использование цепочек настроений"
    priority: "high"
    epic: "Цепочки настроений"

    story:
      as_a: "Ценитель атмосферного прослушивания"
      i_want: "Создавать 'вайбовые' цепочки треков, плавно перетекающих друг в друга"
      so_that: "Получать непрерывный музыкальный опыт, соответствующий моему настроению"

    description: >
      Пользователь хочет не просто плейлист, а умную цепочку треков, где
      каждый следующий трек логично продолжает предыдущий по настроению,
      энергии или жанру. Система должна предлагать варианты следующего трека
      на основе анализа музыки и истории прослушиваний.

    acceptance_criteria:
      - id: "AC-004-1"
        criterion: "Можно создать цепочку настроений с названием и тегами настроения"
        testable: true

      - id: "AC-004-2"
        criterion: "Можно добавить треки вручную с указанием переходов"
        testable: true

      - id: "AC-004-3"
        criterion: "При воспроизведении система предлагает 3 варианта следующего трека"
        testable: true

      - id: "AC-004-4"
        criterion: "Можно создать цепочку автоматически из истории прослушиваний за период"
        testable: true

      - id: "AC-004-5"
        criterion: "Доступны стили перехода: плавный, по энергии, по жанру, случайный"
        testable: true

      - id: "AC-004-6"
        criterion: "Визуализация цепочки показывает связи между треками"
        testable: true

      - id: "AC-004-7"
        criterion: "Пользователь может принять или отклонить предложенный следующий трек"
        testable: true

    scenarios:
      - name: "Интерактивное воспроизведение"
        given: "Пользователь запустил цепочку настроений"
        when: "Текущий трек подходит к концу (осталось 30 секунд)"
        then:
          - "Появляются 3 предложения следующего трека"
          - "Показан % совместимости каждого варианта"
          - "Пользователь выбирает или позволяет авто-выбор"
          - "Выбранный трек плавно начинается (crossfade)"

      - name: "Создание из истории"
        given: "Пользователь слушал музыку весь январь"
        when: "Выбирает 'Создать цепочку из истории' за январь"
        then:
          - "Система анализирует частые переходы между треками"
          - "Создаёт цепочку из 20-30 треков"
          - "Показывает предпросмотр с весами переходов"

      - name: "Ручное создание вайб-цепочки"
        given: "Пользователь хочет создать идеальную вечернюю подборку"
        when: "Открывает конструктор цепочек и добавляет треки"
        then:
          - "Можно искать и добавлять треки"
          - "Видно 'совместимость' трека с предыдущим"
          - "Можно настроить вес перехода вручную"

    ui_elements:
      - "Конструктор цепочек (визуальный редактор)"
      - "Мини-карточки предложений (при воспроизведении)"
      - "Граф связей треков"
      - "Мастер создания из истории"

    api_endpoints:
      - "GET /mood-chains"
      - "POST /mood-chains"
      - "POST /mood-chains/from-history"
      - "GET /mood-chains/{id}/next"
      - "PATCH /mood-chains/{id}"

# =============================================================================
# ИСТОРИЯ 5: СТАТИСТИКА ПРОСЛУШИВАНИЙ
# =============================================================================

  - id: "US-005"
    title: "Просмотр статистики прослушиваний"
    priority: "medium"
    epic: "Аналитика"

    story:
      as_a: "Любопытный меломан"
      i_want: "Видеть статистику своих прослушиваний"
      so_that: "Понимать свои музыкальные предпочтения и открывать закономерности"

    description: >
      Пользователь хочет видеть детальную статистику: топ треков и исполнителей,
      общее время прослушивания, распределение по жанрам и времени суток.
      Это помогает понять свои вкусы и открывает интересные паттерны.

    acceptance_criteria:
      - id: "AC-005-1"
        criterion: "Дашборд показывает общее время прослушивания за период"
        testable: true

      - id: "AC-005-2"
        criterion: "Топ-10 песен с количеством прослушиваний"
        testable: true

      - id: "AC-005-3"
        criterion: "Топ-10 исполнителей"
        testable: true

      - id: "AC-005-4"
        criterion: "Распределение по жанрам (pie chart)"
        testable: true

      - id: "AC-005-5"
        criterion: "График прослушиваний по дням/неделям"
        testable: true

      - id: "AC-005-6"
        criterion: "Тепловая карта активности по часам"
        testable: true

      - id: "AC-005-7"
        criterion: "Выбор периода: неделя, месяц, год, всё время"
        testable: true

      - id: "AC-005-8"
        criterion: "Для каждой песни видно последнее и общее количество прослушиваний"
        testable: true

    scenarios:
      - name: "Обзор месячной статистики"
        given: "Пользователь активно слушал музыку месяц"
        when: "Открывает страницу статистики"
        then:
          - "Видит общее время (например, '48 часов')"
          - "Видит топ-10 треков с обложками"
          - "Видит распределение по жанрам"
          - "Может переключить на другой период"

      - name: "Детальная статистика трека"
        given: "Пользователь смотрит информацию о песне"
        when: "Открывает вкладку 'Статистика'"
        then:
          - "Видит общее количество прослушиваний"
          - "Дату последнего прослушивания"
          - "График прослушиваний по времени"

    ui_elements:
      - "Страница 'Статистика'"
      - "Виджеты с ключевыми метриками"
      - "Графики (line, bar, pie)"
      - "Тепловая карта"
      - "Селектор периода"

    api_endpoints:
      - "GET /stats/overview"
      - "GET /stats/top-songs"
      - "GET /stats/history"

# =============================================================================
# ИСТОРИЯ 6: ПОИСК И ФИЛЬТРАЦИЯ
# =============================================================================

  - id: "US-006"
    title: "Быстрый поиск и фильтрация музыки"
    priority: "high"
    epic: "Поиск"

    story:
      as_a: "Пользователь с большой библиотекой"
      i_want: "Быстро находить нужные треки через поиск и фильтры"
      so_that: "Не тратить время на пролистывание большого каталога"

    description: >
      Когда в библиотеке сотни или тысячи треков, важно иметь быстрый поиск
      и гибкие фильтры для нахождения нужной музыки.

    acceptance_criteria:
      - id: "AC-006-1"
        criterion: "Глобальный поиск доступен с любой страницы (Ctrl+K)"
        testable: true

      - id: "AC-006-2"
        criterion: "Поиск ищет по названию, исполнителю, альбому"
        testable: true

      - id: "AC-006-3"
        criterion: "Результаты появляются по мере ввода (instant search)"
        testable: true

      - id: "AC-006-4"
        criterion: "Можно фильтровать по жанру, году, рейтингу"
        testable: true

      - id: "AC-006-5"
        criterion: "Сортировка: по названию, дате добавления, популярности"
        testable: true

      - id: "AC-006-6"
        criterion: "Можно искать по тегам"
        testable: true

      - id: "AC-006-7"
        criterion: "История поисковых запросов"
        testable: true

    scenarios:
      - name: "Быстрый поиск трека"
        given: "Пользователь хочет найти 'Bohemian Rhapsody'"
        when: "Нажимает Ctrl+K и вводит 'bohemian'"
        then:
          - "Результаты появляются мгновенно"
          - "Нужный трек виден в топе"
          - "Можно запустить прямо из результатов"

      - name: "Фильтрация по жанру"
        given: "Пользователь хочет только рок-музыку"
        when: "Выбирает фильтр 'Жанр: Rock'"
        then:
          - "Показаны только треки жанра Rock"
          - "Фильтр можно комбинировать с поиском"

    ui_elements:
      - "Глобальный поиск (command palette)"
      - "Панель фильтров в библиотеке"
      - "Чипсы активных фильтров"
      - "Сортировка (dropdown)"

    api_endpoints:
      - "GET /search"
      - "GET /songs?search=...&genre=...&sort=..."

# =============================================================================
# ИСТОРИЯ 7: РЕКОМЕНДАЦИИ
# =============================================================================

  - id: "US-007"
    title: "Получение персональных рекомендаций"
    priority: "medium"
    epic: "Рекомендации"

    story:
      as_a: "Слушатель, желающий открывать новую музыку"
      i_want: "Получать рекомендации на основе моих предпочтений"
      so_that: "Находить новые любимые треки в своей библиотеке"

    description: >
      На основе истории прослушиваний и избранного система должна предлагать
      треки из библиотеки, которые пользователь мог не заметить или забыть.

    acceptance_criteria:
      - id: "AC-007-1"
        criterion: "Раздел 'Рекомендации' на главной странице"
        testable: true

      - id: "AC-007-2"
        criterion: "Рекомендации 'Похожие на...' для любого трека"
        testable: true

      - id: "AC-007-3"
        criterion: "'Вы давно не слушали' - забытые треки"
        testable: true

      - id: "AC-007-4"
        criterion: "Объяснение, почему трек рекомендован"
        testable: true

      - id: "AC-007-5"
        criterion: "Возможность отклонить рекомендацию ('не показывать')"
        testable: true

    scenarios:
      - name: "Открытие забытого трека"
        given: "Пользователь давно не слушал некоторые треки"
        when: "Открывает 'Рекомендации'"
        then:
          - "Видит секцию 'Вы давно не слушали'"
          - "Показаны треки с высоким рейтингом, не игравшие 30+ дней"
          - "Может запустить трек или добавить в очередь"

    ui_elements:
      - "Карусель рекомендаций"
      - "Карточка рекомендации с причиной"
      - "Кнопки 'Нравится' / 'Не нравится'"

    api_endpoints:
      - "GET /recommendations/discover"
      - "GET /recommendations/similar/{song_id}"

# =============================================================================
# ДОПОЛНИТЕЛЬНЫЕ ИСТОРИИ
# =============================================================================

additional_stories:

  - id: "US-008"
    title: "Использование тегов для организации"
    priority: "low"
    epic: "Организация"

    story:
      as_a: "Педантичный пользователь"
      i_want: "Добавлять собственные теги к трекам"
      so_that: "Организовать музыку по своим критериям"

    key_features:
      - "Создание пользовательских тегов с цветами"
      - "Добавление нескольких тегов к треку"
      - "Фильтрация библиотеки по тегам"
      - "Быстрое добавление тега через контекстное меню"

  - id: "US-009"
    title: "Офлайн-доступ (PWA)"
    priority: "medium"
    epic: "Мобильность"

    story:
      as_a: "Мобильный пользователь"
      i_want: "Слушать музыку без интернета"
      so_that: "Иметь доступ к любимым трекам в самолёте или метро"

    key_features:
      - "Пометка треков/плейлистов для офлайн-доступа"
      - "Автоматическая загрузка в фоне"
      - "Управление кэшем (лимит по размеру)"
      - "Индикация офлайн-доступности"

  - id: "US-010"
    title: "Импорт из других сервисов"
    priority: "low"
    epic: "Импорт"

    story:
      as_a: "Новый пользователь"
      i_want: "Импортировать плейлисты из Spotify/Apple Music"
      so_that: "Перенести свою музыкальную историю"

    key_features:
      - "Импорт списка треков из CSV/JSON"
      - "Сопоставление с загруженной библиотекой"
      - "Отчёт о найденных/ненайденных треках"

# =============================================================================
# МАТРИЦА ПРИОРИТЕТОВ
# =============================================================================

priority_matrix:
  must_have:
    - "US-001: Загрузка музыки"
    - "US-002: Воспроизведение"
    - "US-003: Плейлисты"
    - "US-006: Поиск"

  should_have:
    - "US-004: Цепочки настроений"
    - "US-005: Статистика"
    - "US-007: Рекомендации"

  could_have:
    - "US-008: Теги"
    - "US-009: Офлайн"
    - "US-010: Импорт"

# =============================================================================
# ПЕРСОНЫ ПОЛЬЗОВАТЕЛЕЙ
# =============================================================================

user_personas:

  - name: "Алексей, 28"
    type: "Активный слушатель"
    description: >
      Программист, слушает музыку 4-5 часов в день во время работы.
      Имеет большую коллекцию FLAC-файлов. Ценит качество звука
      и удобную организацию библиотеки.
    goals:
      - "Быстро находить нужную музыку"
      - "Не отвлекаться на управление плеером"
      - "Иметь разные плейлисты для разных задач"
    pain_points:
      - "Текущий плеер неудобен"
      - "Сложно организовать 5000+ треков"

  - name: "Мария, 24"
    type: "Вайб-слушатель"
    description: >
      Дизайнер, для неё музыка — это настроение. Любит создавать
      атмосферные подборки и плавные переходы между треками.
    goals:
      - "Создавать идеальные вайбовые подборки"
      - "Открывать связи между треками"
      - "Делиться настроением"
    pain_points:
      - "Плейлисты слишком статичны"
      - "Нет инструмента для 'вайб-цепочек'"

  - name: "Дмитрий, 35"
    type: "Коллекционер"
    description: >
      Аудиофил с 15-летней коллекцией музыки. Педантично организует
      метаданные, следит за качеством файлов, ведёт статистику.
    goals:
      - "Полный контроль над метаданными"
      - "Детальная статистика прослушиваний"
      - "Поддержка lossless форматов"
    pain_points:
      - "Сервисы портят метаданные"
      - "Нет нормальной статистики"
